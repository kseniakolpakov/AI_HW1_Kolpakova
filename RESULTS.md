# Результаты проделанной работы
 ## EDA и предобработка данных
 В результате проделанной работы:
 1. Построили дэшборд для всего набора данных с помощью ProfileReport. С его помощью определили, что в данных есть пропуски, посмотрели на распределения числовых признаков (не все они стремятся к нормальному распределению),  выявили, что в наборе данных есть выбросы. 
 2. Удалили дубликаты. 
 3. Преобразовали признаки 'mileage' и 'engine' в числовые. 
 4. Признак 'torque' разбили на два признака: 'torque' и 'max_torque_rpm' с учетом единиц измерения. 
 5. Заполнили пропуски в обучающем и тестовом наборах данных медианными значениями для каждого признака (медиана была рассчитана на обучающем наборе данных, чтобы не было "заглядывания в будущее" на тестовом наборе). 
 6. Рассмотрели различные варианты корреляций между всеми признаками. Выявили, что больше всего на целевую переменную влияют следующие признаки: 'max_power', 'torque' и 'year'.  

## Обучение моделей
1. Построили линейную регрессию на вещественных признаках, получили следующие метрики качества:
`R2 = 0.6`
`MSE = 228'408'698'888`
2. Стандартизировали метрики с помощью StandardScaler, заново обучили линейную регрессию. Получили:
`R2 = 0.6`
`MSE = 228'408'698'888`
3. Обучили модель Lasso, получили следующие результаты:
`R2 = 0.6`
`MSE = 228'409'460'800`
4. Для Lasso регрессии подобрали гиперпараметры с помощью поиска по сетке. Получили наилучшие гиперпараметры и метрику качества:
`Лучшие гиперпараметры: {'alpha': 3.0, 'max_iter': 100, 'random_state': 42, 'tol': 0.0001}`
`R2 = 0.6`
`MSE = 228'410'988'859`
5. Аналогично, с помощью поиска по сетке подобрали гиперпараметры для ElasticNet:
`{'alpha': 0.046415888336127774, 'l1_ratio': 0.3, 
'max_iter': 1000,'tol': 0.01}`
`R2 = 0.6`
`MSE = 232'080'202'774`
Для всех данных моделей метрики качества не сильно разнятся и остаются достаточно низкими. С целью повышения качества были добавлены категориальные признаки, результаты работы приведены в следующем разделе
6. Реализовали модель линейной регрессии с L0-регуляризацией. Остались такими же, как и при обычной линейной регрессией, а коэффициенты модели не занулились и оказались большими:
`R2 = 0.6`
`MSE = 228'408'698'888`

*Метрики качества рассчитаны на тестовых выборках 
## Добавление категориальных признаков 
1. Преобразовали столбец 'name' так, чтобы его можно было использовать для дальнейшего построения прогнозов: из строки с полным названием автомобиля достали его марку и "базовое" название модели, данным признакам соответствуют первый и второй элементы строки 'name'. 
2. Применили метод OneHotEncoding для кодирования всх категорияальных признаков, затем для Ridge регрессии подобрали параметр 'alpha' с помощью поиска по сетке. Получили следующие результаты:
`R2 = 0.93`
`MSE = 41'043'308'580`
Можно заметить, что использование категориальных признаков значительно улучшило работу моделей. Метрика R2 возросла, а MSE, наоборот, значительно снизилась. 

## Feature Engineering
Для того, чтобы еще улучшить качество регрессии попробовали сгенерировать новые признаки:
1. Перед этим для удобства обернули обучение модели и преобразование признаков (как категориальных методом OHE, так и числовых с помощью StandardScaler) вынесли обучение и оценку в отдельную функцию с использованием pipeline и ColumnTransformer. 
2. Сгенерировали новые признаки: год в квадрате и отношение числа лошадиных сил к литру объема. Однако, метрики качества не стали лучше:
`R2 = 0.92`
`MSE = 48'016'560'330`
3. Удалили выбросы из числовых признаков с помощью метода трех сигм (только для обучающего набора данных).  Получили следующие метрики качества:
`R2 = 0.5`
`MSE = 267'328'880'334`
Метрики значительно стали хуже. 
4. Затем провели логорифмирование признаков: 'km_driven', 'engine', 'torque', 'max_torque_rpm'. Однако, это не прибавило улучшения:
`R2 = 0.9`
`MSE = 59'967'421'827`

## Бизнес-метрики
1. Рассчитали следующую бизнес-метрику: среди всех предсказанных цен на авто нужно посчитать долю прогнозов, отличающихся от реальных цен на эти авто не более чем на 10% (в одну или другую сторону). Получилось, что наилучшая модель и осталась модель Ridge-регрессии, обученная на числовых и категориальных признаках. 
Полученная бизнес метрика равна `0.358`, что не является высоким результатом, однако он выше результатов других моделей. 
2. Рассчитали кастомную бизнес метрику, которая оценивает ошибки модели, при этом штрафуя модель за недопрогноз сильнее чем перепрогноз. 
Опять же наилучший результат показала модель Ridge-регрессии, значение кастомной метрики равно `149'185` (рубля). 

## Итог
Наилучшая модель по метрике MSE и по реализованным бизнес-метрикам оказалась модель Ridge-регресси, которая была обучена на следующих признаках:

- Численные: 'year', 'km_driven', 'mileage', 'engine', 'max_power', 'torque', 'max_torque_rpm'
- Категориальные: 'fuel', 'seller_type', 'transmission', 'owner', 'seats', 'brand', 'model'

Числовые данные были масштабированы с помощью StandardScaler, а категориальные данные преобразованы с помощью метода OneHotEncoder. 

Числовые данные при этом обрабатываются с помощью масштабирования StandardScaler, а числовые - методам OneHotEncoding.  

Итоговые метрики качества равны:
`R2 = 0.9`
`MSE = 59'967'421'827`
`Бизнес-метрика = 0.358`
`Кастомная бизнес метрика = 149'185`

На данный момент (к 27 ноября) не был реализована часть FastApi, но ко второму дэдлайну этот момент будет сделан. 

